<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù…Ø·Ø¹Ù… ØµÙ…Ù‘Ø§Ù…</title>
  <link rel="stylesheet" href="style.css" />
  <style>
      /* --- ÙƒÙ„Ø§Ø³ Ø§Ù„Ø¥Ø®ÙØ§Ø¡ --- */
      .hidden { display: none !important; }

      /* --- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠ --- */
      #announcement-bar {
          background-color: #fef3c7;
          color: #92400e;
          font-weight: bold;
          padding: 12px 0;
          display: none; /* ÙŠØªÙ… Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù‡ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          z-index: 2000;
          text-align: center;
          justify-content: center;
          box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      }
      .marquee-container {
          width: 100%;
          overflow: hidden;
          white-space: nowrap;
      }
      .marquee {
          display: inline-block;
          padding-left: 100%;
          animation: marquee 20s linear infinite;
      }
      @keyframes marquee {
          0% { transform: translate(0, 0); }
          100% { transform: translate(100%, 0); }
      }

      /* --- Ø´Ø§Ø±Ø© Ø§Ù„Ø®ØµÙ… ÙˆØ§Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ… --- */
      .discount-badge {
          position: absolute;
          top: 10px;
          right: 10px;
          background-color: #dc2626; /* Ø£Ø­Ù…Ø± */
          color: white;
          padding: 4px 8px;
          border-radius: 4px;
          font-size: 12px;
          font-weight: bold;
          z-index: 10;
          box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      }
      .old-price {
          text-decoration: line-through;
          color: #9ca3af;
          font-size: 0.9em;
          margin-left: 5px;
      }

      /* --- ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© --- */
      .menu-item-type, .menu-item-rice { margin: 10px 0; }
      .menu-item-type label, .menu-item-rice label {
          display: block; font-size: 12px; font-weight: bold; margin-bottom: 5px; color: #555;
      }
      .custom-select {
          width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;
          background: #f9f9f9; font-family: inherit; font-size: 14px; color: #333;
      }
      .custom-select:focus { outline: none; border-color: #e65100; }
      
      button.add-to-cart:disabled { background-color: #ccc !important; cursor: not-allowed; opacity: 0.6; }
      
      /* --- ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© --- */
      .cart-input {
          width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd;
          border-radius: 5px; font-family: inherit; font-size: 14px;
      }
      .cart-section-title {
          font-weight: bold; margin: 15px 0 10px; font-size: 14px; color: #e65100;
          border-bottom: 1px solid #eee; padding-bottom: 5px;
      }
      .dynamic-fields {
          background: #f9f9f9; padding: 10px; border-radius: 5px; margin-bottom: 10px;
          border: 1px solid #eee;
      }
      
      img[src=""] { display: none; }
  </style>
</head>
<body>

<!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª -->
<div id="announcement-bar">
    <div class="marquee-container">
        <div class="marquee" id="announcement-text">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…Ø·Ø¹Ù… ØµÙ…Ù‘Ø§Ù…</div>
    </div>
</div>

<div class="header-bg" id="headerBg"></div>
<header class="main-header">
  <div class="header-container">
      <div class="header-title">
         <img src="images/SAMAM HEADER.png" alt="Samam Logo" class="logo-img" onerror="this.style.display='none'" />
      </div>

      <!-- Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© -->
      <div class="menu-toggle" id="menuToggle">â˜°</div>

      <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
      <nav class="mobile-menu" id="mobileMenu">
        <ul>
          <li><a href="#" onclick="window.scrollTo(0,0); return false;">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
          <li><a href="#" id="toggleAboutBtn">Ù…Ù† Ù†Ø­Ù†</a></li>
          <li><a href="#menu">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø¹Ø§Ù…</a></li>
          <li><a href="#contact-footer">Ø§ØªØµÙ„ Ø¨Ù†Ø§</a></li>
        </ul>
      </nav>

      <div class="cart-container">
        <img src="https://cdn-icons-png.flaticon.com/512/833/833314.png" alt="Ø§Ù„Ø³Ù„Ø©" class="cart-icon" />
        <span class="cart-count">0</span>
      </div>
    </div>
</header>

<section class="hero-section">
  <img src="images/hero 1.jpg (2).jpg" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø·Ø¹Ù…" class="hero-img" id="hero-img-element" onerror="this.src='https://via.placeholder.com/1500x800?text=Samam'">
  <div class="hero-overlay"></div>
  <div class="hero-logo">
    <img src="images/logo p.png" alt="Ù„ÙˆØ¬Ùˆ ÙÙˆÙ‚ Ø§Ù„ØµÙˆØ±Ø©" onerror="this.style.display='none'">
  </div>

  <div class="hero-content">
    <h1 class="hero-title" id="hero-title-text">Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€ Ù…Ø¶ØºÙˆØ· ÙˆØ§ÙƒØ«Ø±</h1>
    <a href="#menu" class="menu-btn">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø¹Ø§Ù…</a>
  </div>

  <div class="hero-services">
    <p>
      Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ø¹Ø§Ø´Ø© ÙˆØ§Ù„ÙƒÙ…ÙŠØ§Øª<br>
      ( Ø´Ø±ÙƒØ§Øª - Ø¬Ù…Ø¹ÙŠØ§Øª - Ø¥ÙØ·Ø§Ø± ØµØ§Ø¦Ù… )
    </p>
    <a href="https://wa.me/966592372549" target="_blank">
      Ø§Ø¶ØºØ· Ù‡Ù†Ø§
    </a>
  </div>
</section>

<!-- Ù‚Ø³Ù… Ù…Ù† Ù†Ø­Ù† -->
<section class="about-section hidden" id="about">
  <h2 class="about-title">Ù…Ù† Ù†Ø­Ù†</h2>
  <div class="about-boxes">
    <div class="about-box">
      <h3> ØµÙ…Ù‘Ø§Ù…</h3>
      <p>Ø¹Ù„Ø§Ù…Ø© ØªØ¬Ø§Ø±ÙŠØ© ØªØ£Ø³Ø³Øª ÙÙŠ Ø¹Ø§Ù… 2024ØŒ Ø¨Ø®Ø¨Ø±Ø© ØªØ³Ø¨Ù‚ Ø³Ù†Ø© Ø§Ù„ØªØ£Ø³ÙŠØ³ Ø¨Ø£Ø¹ÙˆØ§Ù… Ø¹Ø¯ÙŠØ¯Ø© ÙˆØ´ØºÙ ÙƒØ¨ÙŠØ±. Ù‚ÙØ¯ÙÙ…Ù†Ø§ Ø¨ÙÙƒØ±Ø© Ù†Ø¹ÙŠØ¯ ÙÙŠÙ‡Ø§ ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£ÙƒÙ„Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©ØŒ ÙˆÙ†Ù‚Ø¯Ù‘Ù…Ù‡Ø§ Ø¨Ø±ÙˆØ­ Ø¬Ø¯ÙŠØ¯Ø© ØªÙØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø£ØµØ§Ù„Ø©â€¦ ÙˆÙ„ÙƒÙ† Ø¨Ù„Ù…Ø³Ø© ØµÙ…Ù‘Ø§Ù… Ø§Ù„Ø®Ø§ØµØ©.</p>
    </div>
    <div class="about-box">
      <h3>Ù‡Ø¯ÙÙ†Ø§</h3>
      <p>Ù†ÙØ­Ø³Ù‘Ù† Ø§Ù„Ø«Ù‚Ø§ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø© Ø¹Ù† Ø§Ù„Ù†ÙƒÙ‡Ø§ØªØŒ ÙˆÙ†Ù‚Ø¯Ù… Ø£Ø·Ø¨Ø§Ù‚Ù†Ø§ Ø¨Ø´ÙƒÙ„ Ù„Ø§Ø¦Ù‚ ÙˆÙŠØ¹Ø¨Ù‘Ø± Ø¹Ù† Ø¬ÙˆØ¯ØªÙ†Ø§.</p>
    </div>
    <div class="about-box">
      <h3>Ø±Ø¤ÙŠØªÙ†Ø§</h3>
      <p>Ù†ÙØµØ¨Ø­ Ø§Ù„ÙˆØ¬Ù‡Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙˆÙ†ÙƒÙÙˆÙ† Ø¨ØµÙ…Ø© ØªÙÙ…ÙŠÙØ² ØªØ¹ÙƒØ³ Ø§Ù„Ù‡ÙˆÙŠØ© ÙÙŠ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù…Ø£ÙƒÙˆÙ„Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø­Ø¯ÙŠØ«Ø©.</p>
    </div>
    <div class="about-box">
      <h3>ÙˆØ´ ÙŠÙ…ÙŠØ²Ù†Ø§</h3>
      <p>ÙˆØµÙØ§Øª Ù…Ø·ÙˆØ±Ø© Ø¨Ù†ÙƒÙ‡Ø§ØªÙ†Ø§ Ø§Ù„Ø®Ø§ØµØ©ØŒ Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© ÙˆØ·Ø¹Ù… ÙŠØ±Ø³Ø® Ø¨Ø§Ù„Ø°Ø§ÙƒØ±Ø©ØŒ Ø£ØµÙ†Ø§Ù ØªØ°ÙƒØ±Ùƒ Ø¨Ø§Ù„Ù…Ø§Ø¶ÙŠâ€¦ Ø¨Ø³ Ø¨Ø·Ø±ÙŠÙ‚ØªÙ†Ø§.</p>
    </div>
  </div>
</section>

<!-- Ù‚Ø³Ù… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø¹Ø§Ù… -->
<section id="menu" class="menu-section">
  <h2 class="section-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø¹Ø§Ù…</h2>

  <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
  <div class="category-buttons">
    <button class="category-btn active" data-category="all">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
    <button class="category-btn" data-category="chicken">Ø¯Ø¬Ø§Ø¬</button>
    <button class="category-btn" data-category="meat">Ù„Ø­Ù…</button>
    <button class="category-btn" data-category="rice">Ø±Ø²</button>
    <button class="category-btn" data-category="sides">Ø·Ù„Ø¨Ø§Øª Ø¬Ø§Ù†Ø¨ÙŠØ©</button>
    <button class="category-btn" data-category="drinks">Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª</button>
  </div>

  <!-- Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
  <div class="menu-items">
    <div id="chicken" class="menu-group"></div>
    <div id="meat" class="menu-group" style="display:none;"></div>
    <div id="rice" class="menu-group" style="display:none;"></div>
    <div id="sides" class="menu-group" style="display:none;"></div>
    <div id="drinks" class="menu-group" style="display:none;"></div>
    
    <div id="loading-msg" style="text-align: center; width: 100%; padding: 40px; color: #666; font-size: 1.2em;">
      <span style="display:inline-block; animation: spin 1s linear infinite">â³</span> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©...
    </div>
  </div>
</section>

<!-- Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
<div class="cartSlider" id="cartSlider_v2">
  <div class="cartSlider-header">
    <h3>Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
    <span class="cartSlider-close" id="closeCart_v2">&times;</span>
  </div>

  <div class="cartSlider-items" id="cartItems_v2">
    <p class="empty-cart">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠØ§</p>
  </div>

  <div class="cartSlider-options" style="padding: 0 15px;">
    <div class="cart-section-title">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ù…Ø·Ù„ÙˆØ¨Ø©)</div>
    <input type="text" id="customerName" class="cart-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ±ÙŠÙ…" required>
    <input type="tel" id="customerPhone" class="cart-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (05xxxxxxxx)" required>

    <div class="cart-section-title">Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø·Ù„Ø¨</div>
    <label style="font-size:12px; font-weight:bold;">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:</label>
    <select id="deliveryMethod_v2" class="cart-input">
      <option value="Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„ÙØ±Ø¹">Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„ÙØ±Ø¹</option>
      <option value="ØªÙˆØµÙŠÙ„">ØªÙˆØµÙŠÙ„ (Ø±Ø³ÙˆÙ… 15 Ø±.Ø³)</option>
      <option value="ØªØ³Ù„ÙŠÙ… Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ø±Ø©">ØªØ³Ù„ÙŠÙ… Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</option>
    </select>

    <div id="deliveryFields" class="dynamic-fields" style="display:none;">
      <label style="font-size:12px; font-weight:bold;">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„:</label>
      <input type="text" id="addressDetail" class="cart-input" placeholder="Ø§Ù„Ø­ÙŠØŒ Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø±Ù‚Ù… Ø§Ù„Ù…Ù†Ø²Ù„">
      <label style="font-size:12px; font-weight:bold;">Ø¹Ù„Ø§Ù…Ø© Ù…Ù…ÙŠØ²Ø©:</label>
      <input type="text" id="landmark" class="cart-input" placeholder="Ø¨Ø¬ÙˆØ§Ø± Ù…Ø³Ø¬Ø¯/Ù…Ø¯Ø±Ø³Ø©...">
    </div>

    <div id="carFields" class="dynamic-fields" style="display:none;">
      <label style="font-size:12px; font-weight:bold;">Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©:</label>
      <input type="text" id="carType" class="cart-input" placeholder="Ù…Ø«Ø§Ù„: ØªÙˆÙŠÙˆØªØ§ ÙƒØ§Ù…Ø±ÙŠ">
      <label style="font-size:12px; font-weight:bold;">Ù„ÙˆØ­Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©:</label>
      <input type="text" id="carPlate" class="cart-input" placeholder="Ù…Ø«Ø§Ù„: Ø£ Ø¨ Ø¬ 1234">
    </div>

    <label style="font-size:12px; font-weight:bold;">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</label>
    <select id="paymentMethod_v2" class="cart-input">
      <option value="ÙƒØ§Ø´">ÙƒØ§Ø´ (Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…)</option>
      <option value="Ø´Ø¨ÙƒØ©">Ø´Ø¨ÙƒØ© (Ù…Ø¯Ù‰/ÙÙŠØ²Ø§)</option>
    </select>
  </div>

  <div class="cartSlider-discount">
    <label>ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…:</label>
    <div style="display:flex; gap:5px;">
        <input type="text" id="discountCode_v2" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯" style="flex:1;">
        <button id="applyDiscountBtn_v2">ØªØ·Ø¨ÙŠÙ‚</button>
    </div>
    <p id="discountMessage_v2" style="margin-top: 5px; font-size: 0.9em;"></p>
  </div>

  <div class="cartSlider-total" id="cartTotal_v2">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: 0 Ø±ÙŠØ§Ù„</div>

  <button class="cartSlider-send" id="sendOrder_v2">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
</div>

<footer class="site-footer" id="contact-footer">
  <div class="footer-container">
    <div class="footer-brand">
      <div class="logo-wrapper">
        <img src="images/logo red.png" alt="Ø´Ø¹Ø§Ø± Ù…Ø·Ø¹Ù… ØµÙ…Ù‘Ø§Ù…" class="restaurant-logo" onerror="this.style.display='none'">
      </div>
      <h3>Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€ Ù…Ø¶ØºÙˆØ· ÙˆØ§ÙƒØ«Ø±</h3>
      <p class="restaurant-address">Ø¬Ø¯Ø© - Ø´Ø§Ø±Ø¹ Ø§Ù„Ø­Ø±Ø§Ø²Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</p>
    </div>

    <div class="footer-social-section">
      <h4 class="section-title">ÙƒÙŠÙ ØªÙˆØµÙ„Ù†Ø§</h4>
      <div class="footer-social">
        <a href="https://wa.me/966539490701" target="_blank" title="ÙˆØ§ØªØ³Ø§Ø¨"><img src="images/social.png" alt="ÙˆØ§ØªØ³Ø§Ø¨" style="--i:0;"></a>
        <a href="https://www.instagram.com/samamrst?igsh=M2oxOGFqcW9sZjMw" target="_blank" title="Ø§Ù†Ø³ØªØ¬Ø±Ø§Ù…"><img src="images/instagram (1).png" alt="Ø§Ù†Ø³ØªØ¬Ø±Ø§Ù…" style="--i:2;"></a>
        <a href="https://www.tiktok.com/@samamrst?_r=1&_t=ZS-91NtHAHEunf" target="_blank" title="ØªÙŠÙƒ ØªÙˆÙƒ"><img src="images/tik-tok.png" alt="ØªÙŠÙƒ ØªÙˆÙƒ" style="--i:3;"></a>
        <a href="https://twitter.com/yourpage" target="_blank" title="X - ØªÙˆÙŠØªØ±"><img src="images/twitter.png" alt="X - ØªÙˆÙŠØªØ±" style="--i:4;"></a>
        <a href="https://maps.app.goo.gl/u3taVpScWA5DGfMRA" target="_blank" title="Ù…ÙˆÙ‚Ø¹Ù†Ø§"><img src="images/map.png" alt="Ù…ÙˆÙ‚Ø¹Ù†Ø§" style="--i:5;"></a>
      </div>
    </div>

    <div class="footer-delivery-section">
      <h4 class="section-title">Ù…ØªÙˆØ§Ø¬Ø¯ÙˆÙ† Ø¹Ù„Ù‰ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h4>
      <div class="delivery-icons">
        <a href="#" target="_blank"><img src="images/images.png" alt="ÙƒÙŠØªØ§" style="--i:1;"></a>
      </div>
    </div>
  </div>
  
  <div class="footer-bottom">
    <p>Â© 2025 ØµÙ…Ù‘Ø§Ù…. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
  </div>
</footer>

<div id="ad-overlay" style="display:none;"><div class="ad-box"><button class="close-ad">Ã—</button><div class="ad-image-wrapper"><img id="popup-ad-img" src="" alt="Ø¥Ø¹Ù„Ø§Ù†" /><a href="https://wa.me/966592372549" target="_blank" class="ad-btn">Ø§Ø¶ØºØ· Ù‡Ù†Ø§</a></div></div></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, getDocs, doc, getDoc, addDoc, serverTimestamp, query, where, setDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB0bLzrTbWlgiSyIo9YUsJIp07L_bCclfg",
    authDomain: "samam-f3d54.firebaseapp.com",
    projectId: "samam-f3d54",
    storageBucket: "samam-f3d54.firebasestorage.app",
    messagingSenderId: "635639197847",
    appId: "1:635639197847:web:b61900b409114792a9b9d2",
    measurementId: "G-GQKHFZRENQ"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let cartItems = [];
  const deliveryFee = 15;
  let appliedDiscount = 0;
  let appliedCodeName = "";
  
  const categoryMap = {'Ø¯Ø¬Ø§Ø¬':'chicken','Ù„Ø­Ù…':'meat','Ø±Ø²':'rice','Ø·Ù„Ø¨Ø§Øª Ø¬Ø§Ù†Ø¨ÙŠØ©':'sides','Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª':'drinks'};

  async function trackVisit() {
      const analyticsRef = doc(db, 'analytics', 'visitors');
      const today = new Date().toLocaleDateString('en-CA');
      const currentMonth = today.slice(0, 7);
      try {
          const docSnap = await getDoc(analyticsRef);
          if (!docSnap.exists()) {
              await setDoc(analyticsRef, { total: 1, [`daily_${today}`]: 1, [`monthly_${currentMonth}`]: 1 });
          } else {
              await updateDoc(analyticsRef, { total: increment(1), [`daily_${today}`]: increment(1), [`monthly_${currentMonth}`]: increment(1) });
          }
      } catch (e) { console.log("Analytics Error (Silent):", e); }
  }

  async function loadData() {
    trackVisit();
    const loadingMsg = document.getElementById('loading-msg');
    try {
      const settingsDoc = await getDoc(doc(db, 'settings', 'general'));
      if (settingsDoc.exists()) {
          const settings = settingsDoc.data();
          if(settings.heroTitle) document.getElementById('hero-title-text').innerText = settings.heroTitle;
          if(settings.heroImage) document.getElementById('hero-img-element').src = settings.heroImage;
          const announcementBar = document.getElementById('announcement-bar');
          if(settings.showAnnouncement && settings.announcement) {
              announcementBar.style.display = 'flex';
              document.getElementById('announcement-text').innerText = settings.announcement;
              if (settings.announcementBgColor) announcementBar.style.backgroundColor = settings.announcementBgColor;
              if (settings.announcementTextColor) announcementBar.style.color = settings.announcementTextColor;
              document.body.style.paddingTop = announcementBar.offsetHeight + 'px';
          }
          const adOverlay = document.getElementById('ad-overlay');
          const popupImg = document.getElementById('popup-ad-img');
          if(settings.showPopup && settings.popupImage) {
              popupImg.src = settings.popupImage;
              adOverlay.style.display = 'flex';
          } else {
              adOverlay.style.display = 'none';
          }
      }

      const querySnapshot = await getDocs(collection(db, 'menu'));
      if (querySnapshot.empty) {
          if (loadingMsg) loadingMsg.innerText = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙ†Ø§Ù ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.";
          return;
      }
      
      if (loadingMsg) loadingMsg.style.display = 'none';
      Object.values(categoryMap).forEach(id => { const el = document.getElementById(id); if(el) el.innerHTML = ''; });
      
      const menuItems = [];
      querySnapshot.forEach((doc) => { menuItems.push({ id: doc.id, ...doc.data() }); });
      menuItems.sort((a, b) => (a.order || 999) - (b.order || 999));

      menuItems.forEach((item) => {
        try {
            if (item.status === 'ØºÙŠØ± Ù…ØªØ§Ø­') return;
            const catKey = (item.category || '').trim();
            const containerId = categoryMap[catKey] || 'chicken';
            const container = document.getElementById(containerId);
            
            if (container) {
              let sizesHTML = '';
              let basePrice = item.price || 0;
              
              if (item.hasSizes && item.sizes && Array.isArray(item.sizes) && item.sizes.length > 0) {
                  basePrice = 0; 
                  sizesHTML = `<div class="menu-item-size">${item.sizes.map((s, index) => `<button class="size-btn" data-index="${index}" onclick="selectSize(this)">${s.name}</button>`).join('')}</div>`;
              }
              let typeHTML = '';
              if (item.hasPlainOption) {
                  typeHTML = `<div class="menu-item-type"><label>Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨:</label><select class="type-select custom-select" onchange="handleTypeChange(this)"><option value="" disabled selected hidden>Ø§Ø®ØªØ± (Ø³Ø§Ø¯Ø© / Ù…Ø¹ Ø§Ù„Ø±Ø²)</option><option value="plain">Ø³Ø§Ø¯Ø©</option><option value="with_rice">Ù…Ø¹ Ø§Ù„Ø±Ø²</option></select></div>`;
              }
              let riceHTML = '';
              if (item.hasRiceSelection && item.riceTypes && Array.isArray(item.riceTypes) && item.riceTypes.length > 0) {
                  riceHTML = `<div class="menu-item-rice" style="${item.hasPlainOption ? 'display:none;' : ''}"><label>Ù†ÙˆØ¹ Ø§Ù„Ø±Ø²:</label><select class="rice-select custom-select" onchange="calculateCardPrice(this)"><option value="" disabled selected hidden>Ø¨Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø²</option>${item.riceTypes.map(r => { const rName = typeof r === 'object' ? r.name : r; const rPrice = typeof r === 'object' ? (r.price || 0) : 0; const label = rPrice > 0 ? `${rName} (+${rPrice} Ø±.Ø³)` : rName; return `<option value="${rName}" data-extra="${rPrice}">${label}</option>`; }).join('')}</select></div>`;
              }
              
              let sizesDataSafe = '';
              if (item.hasSizes && Array.isArray(item.sizes)) {
                  sizesDataSafe = encodeURIComponent(JSON.stringify(item.sizes));
              }
              
              const discountVal = parseInt(item.discount) || 0;
              const discountBadge = (discountVal > 0) ? `<div class="discount-badge">Ø®ØµÙ… ${discountVal}%</div>` : '';

              const cardHTML = `
                <div class="menu-item-card" data-id="${item.id}" data-base-price="${item.price || 0}" data-has-plain="${item.hasPlainOption || false}" data-sizes="${sizesDataSafe}" data-discount="${discountVal}">
                  ${discountBadge}
                  <div class="menu-item-img">${item.image ? `<img src="${item.image}" alt="${item.name}" onerror="this.src='images/logo p.png'">` : ''}<span class="calories">${item.calories || ''}</span></div>
                  <h3 class="menu-item-title">${item.name}</h3>
                  ${sizesHTML}${typeHTML}${riceHTML}
                  <div class="menu-item-quantity"><label>Ø§Ù„ÙƒÙ…ÙŠØ©:</label><div class="quantity-box"><button type="button" class="qty-btn minus" onclick="updateCardQty(this, -1)">âˆ’</button><span class="quantity-input">1</span><button type="button" class="qty-btn plus" onclick="updateCardQty(this, 1)">+</button></div></div>
                  <div class="menu-item-price"><p class="new-price">Ø§Ù„Ø³Ø¹Ø± : <span class="price price-display">${basePrice > 0 ? basePrice : '0'}</span> Ø±.Ø³</p></div>
                  <button class="add-to-cart" disabled onclick="addToCart(this)">Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø³Ù„Ø© Ù…Ø´ØªØ±ÙŠØ§ØªÙƒ</button>
                </div>
              `;
              container.insertAdjacentHTML('beforeend', cardHTML);
              if (container.lastElementChild) validateSelection(container.lastElementChild);
            }
        } catch (itemError) { console.error("Error rendering item:", itemError); }
      });
    } catch (error) { 
        console.error("Error loading data:", error);
        if (loadingMsg) loadingMsg.innerText = "ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
    }
  }

  const menuToggle = document.getElementById('menuToggle');
  const mobileMenu = document.getElementById('mobileMenu');
  if (menuToggle && mobileMenu) {
      menuToggle.addEventListener('click', () => { mobileMenu.classList.toggle('open'); });
  }

  document.querySelectorAll('.mobile-menu a').forEach(link => {
      link.addEventListener('click', (e) => {
          if (link.id !== 'toggleAboutBtn') { mobileMenu.classList.remove('open'); }
      });
  });

  const aboutSection = document.getElementById('about');
  const toggleAboutBtn = document.getElementById('toggleAboutBtn');
  if (toggleAboutBtn && aboutSection) {
      toggleAboutBtn.addEventListener('click', (e) => {
          e.preventDefault();
          if (aboutSection.classList.contains('hidden')) { 
              aboutSection.classList.remove('hidden'); 
              mobileMenu.classList.remove('open'); 
              aboutSection.scrollIntoView({ behavior: 'smooth' }); 
              const boxes = document.querySelectorAll('.about-box'); 
              boxes.forEach(box => { box.style.opacity = '1'; box.style.transform = 'translateY(0)'; }); 
          } else { 
              aboutSection.classList.add('hidden'); 
              mobileMenu.classList.remove('open'); 
          }
      });
  }

  window.handleTypeChange = function(select) {
      const card = select.closest('.menu-item-card');
      const riceDiv = card.querySelector('.menu-item-rice');
      if (riceDiv) {
          if (select.value === 'plain') { riceDiv.style.display = 'none'; const riceSelect = riceDiv.querySelector('select'); if(riceSelect) riceSelect.value = ""; } else { riceDiv.style.display = 'block'; }
      }
      calculateCardPrice(select);
  };

  window.validateSelection = function(card) {
      const riceSelect = card.querySelector('.rice-select');
      const typeSelect = card.querySelector('.type-select');
      const sizeBtns = card.querySelectorAll('.size-btn');
      const addBtn = card.querySelector('.add-to-cart');
      let isValid = true;
      let btnText = "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø³Ù„Ø© Ù…Ø´ØªØ±ÙŠØ§ØªÙƒ";

      if (sizeBtns.length > 0 && !card.querySelector('.size-btn.active')) { isValid = false; btnText = "Ø§Ø®ØªØ± Ø§Ù„Ø­Ø¬Ù…"; }
      if (typeSelect && typeSelect.value === "") { isValid = false; if(btnText === "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø³Ù„Ø© Ù…Ø´ØªØ±ÙŠØ§ØªÙƒ") btnText = "Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨"; }
      const riceDiv = card.querySelector('.menu-item-rice');
      if (riceDiv && riceDiv.style.display !== 'none' && riceSelect && riceSelect.value === "") { isValid = false; if(btnText === "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø³Ù„Ø© Ù…Ø´ØªØ±ÙŠØ§ØªÙƒ") btnText = "Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø±Ø²"; }

      if (isValid) { addBtn.disabled = false; addBtn.innerText = "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø³Ù„Ø© Ù…Ø´ØªØ±ÙŠØ§ØªÙƒ"; addBtn.style.opacity = "1"; calculateCardPrice(addBtn); } 
      else { addBtn.disabled = true; addBtn.innerText = btnText; addBtn.style.opacity = "0.6"; }
  };

  window.selectSize = function(btn) {
      const card = btn.closest('.menu-item-card');
      card.querySelectorAll('.size-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      calculateCardPrice(btn);
      validateSelection(card);
  };

  window.updateCardQty = function(btn, change) {
      const input = btn.parentElement.querySelector('.quantity-input');
      let val = parseInt(input.innerText);
      val += change;
      if (val < 1) val = 1;
      input.innerText = val;
      calculateCardPrice(btn);
  };

  window.calculateCardPrice = function(element) {
      const card = element.closest('.menu-item-card');
      if (!card) return;

      const priceDisplay = card.querySelector('.price-display');
      const qty = parseInt(card.querySelector('.quantity-input').innerText);
      const hasPlain = card.dataset.hasPlain === 'true';
      const discountPercent = parseFloat(card.dataset.discount) || 0;
      
      let sizes = [];
      if (card.dataset.sizes && card.dataset.sizes !== "undefined") { 
        try { sizes = JSON.parse(decodeURIComponent(card.dataset.sizes)); } catch(e){} 
      }

      let unitPrice = parseFloat(card.dataset.basePrice) || 0;
      const activeSizeBtn = card.querySelector('.size-btn.active');
      if (activeSizeBtn && sizes.length > 0) {
          const index = parseInt(activeSizeBtn.dataset.index);
          const sizeObj = sizes[index];
          if (hasPlain) {
              const typeSelect = card.querySelector('.type-select');
              if (typeSelect && typeSelect.value === 'plain') unitPrice = parseFloat(sizeObj.plainPrice) || 0;
              else if (typeSelect && typeSelect.value === 'with_rice') unitPrice = parseFloat(sizeObj.ricePrice) || 0;
              else unitPrice = 0;
          } else {
              unitPrice = parseFloat(sizeObj.price) || 0;
          }
      }

      let extraPrice = 0;
      const riceSelect = card.querySelector('.rice-select');
      const riceDiv = card.querySelector('.menu-item-rice');
      if (riceDiv && riceDiv.style.display !== 'none' && riceSelect && riceSelect.value !== "") {
          const selectedOption = riceSelect.options[riceSelect.selectedIndex];
          extraPrice = parseFloat(selectedOption.dataset.extra) || 0;
      }

      let discountedUnitPrice = unitPrice;
      if (discountPercent > 0) { discountedUnitPrice = unitPrice - (unitPrice * (discountPercent / 100)); }

      const finalUnitPrice = discountedUnitPrice + extraPrice;
      const totalPrice = finalUnitPrice * qty;

      if (discountPercent > 0 && unitPrice > 0) {
           priceDisplay.innerHTML = `<span class="old-price">${((unitPrice + extraPrice) * qty).toFixed(1)}</span> ${totalPrice.toFixed(1)}`;
      } else {
           priceDisplay.innerText = totalPrice.toFixed(1);
      }
      
      if (element.tagName === 'SELECT') validateSelection(card);
  };

  window.addToCart = function(btn) {
      const card = btn.closest('.menu-item-card');
      const title = card.querySelector('.menu-item-title').innerText;
      const qty = parseInt(card.querySelector('.quantity-input').innerText);
      
      const discountPercent = parseFloat(card.dataset.discount) || 0;
      let sizes = [];
      if (card.dataset.sizes) try { sizes = JSON.parse(decodeURIComponent(card.dataset.sizes)); } catch(e){}
      const hasPlain = card.dataset.hasPlain === 'true';

      let baseUnitPrice = parseFloat(card.dataset.basePrice) || 0;
      let sizeName = "";
      
      const activeSizeBtn = card.querySelector('.size-btn.active');
      if (activeSizeBtn && sizes.length > 0) {
          sizeName = activeSizeBtn.innerText;
          const index = parseInt(activeSizeBtn.dataset.index);
          const sizeObj = sizes[index];
          if (hasPlain) {
              const typeSelect = card.querySelector('.type-select');
              if (typeSelect && typeSelect.value === 'plain') baseUnitPrice = parseFloat(sizeObj.plainPrice) || 0;
              else if (typeSelect && typeSelect.value === 'with_rice') baseUnitPrice = parseFloat(sizeObj.ricePrice) || 0;
          } else {
              baseUnitPrice = parseFloat(sizeObj.price) || 0;
          }
      }

      let extraPrice = 0;
      const riceSelect = card.querySelector('.rice-select');
      const riceDiv = card.querySelector('.menu-item-rice');
      let riceName = "";
      if (riceDiv && riceDiv.style.display !== 'none' && riceSelect && riceSelect.value !== "") {
          riceName = riceSelect.value;
          const selectedOption = riceSelect.options[riceSelect.selectedIndex];
          extraPrice = parseFloat(selectedOption.dataset.extra) || 0;
      }

      let finalBasePrice = baseUnitPrice;
      if (discountPercent > 0) { finalBasePrice = baseUnitPrice - (baseUnitPrice * (discountPercent / 100)); }
      const finalUnitPrice = finalBasePrice + extraPrice;

      let details = sizeName ? `(${sizeName})` : "";
      const typeSelect = card.querySelector('.type-select');
      if (typeSelect && typeSelect.value) { details += ` - ${typeSelect.options[typeSelect.selectedIndex].text}`; }

      const cartItem = { title: title, size: details, rice: riceName, price: finalUnitPrice, qty: qty };
      const existingItem = cartItems.find(i => i.title === cartItem.title && i.size === cartItem.size && i.rice === cartItem.rice);
      if (existingItem) existingItem.qty += qty; else cartItems.push(cartItem);

      updateCartUI();
      openCart();
      const originalText = btn.innerText; btn.innerText = "ØªÙ… âœ“"; btn.style.background = "#22c55e"; setTimeout(() => { btn.innerText = originalText; btn.style.background = ""; }, 1000);
  };

  function updateCartUI() {
      const container = document.getElementById('cartItems_v2');
      const countEl = document.querySelector('.cart-count');
      const totalEl = document.getElementById('cartTotal_v2');
      const deliverySelect = document.getElementById('deliveryMethod_v2');
      container.innerHTML = '';
      let subtotal = 0;
      let totalQty = 0;

      if (cartItems.length === 0) { container.innerHTML = '<p class="empty-cart">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠØ§</p>'; } 
      else {
          cartItems.forEach((item, idx) => {
              const itemTotal = item.price * item.qty;
              subtotal += itemTotal;
              totalQty += item.qty;
              const div = document.createElement('div');
              div.className = 'cart-item';
              div.innerHTML = `<div class="cart-item-header"><strong>${item.title}</strong><button class="remove-item" onclick="window.removeCartItem(${idx})">ğŸ—‘</button></div><div class="cart-item-details"><small style="color:#666">${item.size || ''}</small>${item.rice ? `<br><small style="color:#e65100">Ù†ÙˆØ¹ Ø§Ù„Ø±Ø²: ${item.rice}</small>` : ''}</div><div class="cart-controls"><button class="qty-btn" onclick="window.changeCartQty(${idx}, -1)">-</button><span class="qty-number">${item.qty}</span><button class="qty-btn" onclick="window.changeCartQty(${idx}, 1)">+</button><span class="item-total">${itemTotal.toFixed(1)} Ø±.Ø³</span></div>`;
              container.appendChild(div);
          });
      }
      const isDelivery = deliverySelect.value === 'ØªÙˆØµÙŠÙ„';
      const currentDeliveryFee = isDelivery ? deliveryFee : 0;
      const discountVal = subtotal * appliedDiscount;
      const finalTotal = subtotal + currentDeliveryFee - discountVal;
      countEl.innerText = totalQty;
      let totalHTML = `<div>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${subtotal.toFixed(1)} Ø±.Ø³</div>`;
      if(isDelivery) totalHTML += `<div>Ø§Ù„ØªÙˆØµÙŠÙ„: ${currentDeliveryFee} Ø±.Ø³</div>`;
      if(discountVal > 0) totalHTML += `<div style="color:green">Ø®ØµÙ… (${appliedCodeName}): -${discountVal.toFixed(1)} Ø±.Ø³</div>`;
      totalHTML += `<div style="font-weight:bold; font-size:1.2em; margin-top:5px;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${finalTotal.toFixed(1)} Ø±.Ø³</div>`;
      totalEl.innerHTML = totalHTML;
  }

  window.changeCartQty = function(idx, change) { if (cartItems[idx]) { cartItems[idx].qty += change; if (cartItems[idx].qty < 1) cartItems[idx].qty = 1; updateCartUI(); } };
  window.removeCartItem = function(idx) { cartItems.splice(idx, 1); updateCartUI(); };
  
  const cartSlider = document.getElementById('cartSlider_v2');
  const overlay = document.createElement('div'); overlay.className = 'cart-overlay'; document.body.appendChild(overlay);
  function openCart() { cartSlider.classList.add('open'); overlay.classList.add('show'); }
  function closeCart() { cartSlider.classList.remove('open'); overlay.classList.remove('show'); }
  document.querySelector('.cart-container').addEventListener('click', openCart);
  document.getElementById('closeCart_v2').addEventListener('click', closeCart);
  overlay.addEventListener('click', closeCart);

  document.getElementById('deliveryMethod_v2').addEventListener('change', (e) => {
      const val = e.target.value;
      const carFields = document.getElementById('carFields');
      const deliveryFields = document.getElementById('deliveryFields');
      carFields.style.display = 'none'; deliveryFields.style.display = 'none';
      if (val === 'ØªØ³Ù„ÙŠÙ… Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ø±Ø©') carFields.style.display = 'block'; else if (val === 'ØªÙˆØµÙŠÙ„') deliveryFields.style.display = 'block';
      updateCartUI();
  });

  document.getElementById('applyDiscountBtn_v2').addEventListener('click', async () => {
      const codeInput = document.getElementById('discountCode_v2');
      const code = codeInput.value.trim().toUpperCase();
      const msg = document.getElementById('discountMessage_v2');
      const btn = document.getElementById('applyDiscountBtn_v2');
      if (!code) return;
      btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚..."; btn.disabled = true;
      try {
          const q = query(collection(db, "discounts"), where("code", "==", code));
          const querySnapshot = await getDocs(q);
          if (querySnapshot.empty) { msg.innerText = "ÙƒÙˆØ¯ ØºÙŠØ± ØµØ§Ù„Ø­"; msg.style.color = "red"; appliedDiscount = 0; appliedCodeName = ""; } 
          else {
              let discountData = null; querySnapshot.forEach((doc) => { discountData = doc.data(); });
              if (discountData && discountData.active) {
                  const usageKey = `discount_usage_${code}`; const currentUsage = parseInt(localStorage.getItem(usageKey) || "0");
                  if (currentUsage >= discountData.perUserLimit) { msg.innerText = "ØªØ¬Ø§ÙˆØ²Øª Ø­Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…"; msg.style.color = "red"; appliedDiscount = 0; appliedCodeName = ""; } 
                  else { appliedDiscount = discountData.value; appliedCodeName = code; msg.innerText = `ØªÙ… Ø®ØµÙ… ${(appliedDiscount * 100)}%`; msg.style.color = "green"; }
              } else { msg.innerText = "Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ÙØ¹Ø§Ù„"; msg.style.color = "red"; appliedDiscount = 0; }
          }
      } catch (error) { msg.innerText = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚"; msg.style.color = "red"; }
      btn.innerText = "ØªØ·Ø¨ÙŠÙ‚"; btn.disabled = false; updateCartUI();
  });

  document.getElementById('sendOrder_v2').addEventListener('click', async () => {
      if (cartItems.length === 0) return alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©!");
      const name = document.getElementById('customerName').value.trim();
      const phone = document.getElementById('customerPhone').value.trim();
      const deliveryMethod = document.getElementById('deliveryMethod_v2').value;
      const paymentMethod = document.getElementById('paymentMethod_v2').value;
      if (!name || !phone) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„");

      let extraDetails = "";
      if (deliveryMethod === 'ØªÙˆØµÙŠÙ„') {
          const address = document.getElementById('addressDetail').value.trim();
          const landmark = document.getElementById('landmark').value.trim();
          if (!address) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†");
          extraDetails = `ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${address}\nğŸ“Œ Ø¹Ù„Ø§Ù…Ø© Ù…Ù…ÙŠØ²Ø©: ${landmark}`;
      } else if (deliveryMethod === 'ØªØ³Ù„ÙŠÙ… Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ø±Ø©') {
          const type = document.getElementById('carType').value.trim();
          const plate = document.getElementById('carPlate').value.trim();
          if (!type || !plate) return alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù…Ø·Ù„ÙˆØ¨Ø©");
          extraDetails = `ğŸš— Ø³ÙŠØ§Ø±Ø©: ${type} - ${plate}`;
      }

      let msg = `*Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯* ğŸ›ï¸\n------------------\nğŸ‘¤ ${name}\nğŸ“ ${phone}\n------------------\n`;
      let subtotal = 0;
      const itemsDetails = cartItems.map(item => {
          const itemTotal = item.price * item.qty; subtotal += itemTotal;
          let detail = `â–ªï¸ ${item.title} ${item.size} (x${item.qty})`;
          if (item.rice) detail += ` [Ø±Ø²: ${item.rice}]`;
          return detail;
      }).join('\n');
      msg += itemsDetails + '\n------------------\n';
      const finalTotal = document.getElementById('cartTotal_v2').innerText.split('Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ')[1];
      msg += `ğŸ’µ *Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${finalTotal}*\nğŸ’³ ${paymentMethod}\nğŸšš ${deliveryMethod}\n${extraDetails ? extraDetails : ''}`;

      const now = new Date();
      const ksaDateString = now.toLocaleString('ar-SA', { timeZone: 'Asia/Riyadh', year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', hour12: true });

      try {
          await addDoc(collection(db, 'orders'), {
              itemsString: itemsDetails, total: finalTotal, status: 'Ø¬Ø¯ÙŠØ¯', customerName: name, phone: phone, deliveryType: deliveryMethod, deliveryDetails: extraDetails, paymentType: paymentMethod, orderDateKSA: ksaDateString, createdAt: serverTimestamp()
          });
          if (appliedCodeName) { const usageKey = `discount_usage_${appliedCodeName}`; const currentUsage = parseInt(localStorage.getItem(usageKey) || "0"); localStorage.setItem(usageKey, currentUsage + 1); }
      } catch(e) { console.error("Error", e); }
      window.open(`https://wa.me/966592372549?text=${encodeURIComponent(msg)}`, '_blank');
  });

  const tabs = document.querySelectorAll('.category-btn');
  tabs.forEach(btn => {
      btn.addEventListener('click', () => {
          tabs.forEach(t => t.classList.remove('active')); btn.classList.add('active');
          const cat = btn.dataset.category;
          document.querySelectorAll('.menu-group').forEach(g => {
              if (cat === 'all' || g.id === cat) { g.style.display = 'flex'; g.style.opacity = '0'; setTimeout(() => g.style.opacity = '1', 50); } else { g.style.display = 'none'; }
          });
      });
  });

  document.querySelector('.close-ad').addEventListener('click', () => { document.getElementById('ad-overlay').style.display = 'none'; });
  let lastScroll = 0;
  window.addEventListener('scroll', () => {
      const current = window.scrollY; const header = document.getElementById('headerBg');
      if (current > lastScroll && current > 100) header.style.transform = 'translateY(-100%)'; else header.style.transform = 'translateY(0)';
      lastScroll = current;
  });
  window.onload = loadData;
</script>

</body>
</html>